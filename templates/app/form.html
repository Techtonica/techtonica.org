{% extends "base.html" %}
{% from "form_macros.html" import fieldset, input_field, textarea_field, radio_group, checkbox_field, conduct_checkbox, contact_info, gender_identity_select, pronouns_checkbox_group, age_group_select, race_ethnicity_select %}

{% block title %} Techtonica: Bridging the Tech Gap â€”
Techtonica Application {% endblock title %}

{% block content %}
<section class="application-page">
  <h1>Techtonica Application</h1>
  <form action="#" method="POST" class="application-form" id="app-form-1">
    {% call fieldset('General Applicant Demographics') %}
      {{ contact_info() }}
      {{ gender_identity_select() }}
      {{ pronouns_checkbox_group() }}

      {{ input_field('What is your birth date?', 'birth-date', type='date', required=true) }}

      {{ age_group_select() }}

      {# Phone Number with pattern #}
      <label for="phone-number">Cell phone number with area code </label><br />
      <input
        type="tel"
        name="phone-number"
        id="phone-number"
        pattern="^\+?1?[-.\s]?(\d{3})[-.\s]?(\d{3})[-.\s]?(\d{4})$"
        placeholder="XXX-XXX-XXXX"
        title="Please enter a valid phone number in the format: 415-555-1234 or 1-415-555-1234."
        minlength="10"
        required
        autocomplete="tel"
      /><br />

      {{ radio_group('Are you a U.S. veteran?', 'veteran-status', [('Yes', 'Yes'), ('No', 'No')]) }}
      {{ radio_group('Do you have a disability? (You can find some examples here: https://askjan.org/a-to-z.cfm)', 'disabled-status', [('Yes', 'Yes'), ('No', 'No')]) }}
      <div class="learn-more-wrapper">
        <button class="learn-more-title" type="button" aria-expanded="false">
          Learn More
          <span class="toggle-icon">
            <span class="toggle-icon-plus">+</span>
            <span class="toggle-icon-minus">-</span>
          </span>
        </button>
        <p
          class="learn-more-content"
          tabindex="0"
          aria-labelledby="disabled-status"
        >
          You are considered to have a disability if you have a physical or
          mental impairment or medical condition that substantially limits a
          major life activity.
        </p>
      </div>
      <br />
      {{ radio_group('Are you a parent or legal guardian of a minor?', 'parental-status', [('Yes', 'Yes'), ('No', 'No')]) }}

      {{ race_ethnicity_select() }}

      {{ input_field('What is the full mailing address of where you live? (Don\'t forget unit number, if applicable, and city, state, and zip code.)', 'address', pattern='^\\d+\\s[A-z]+\\s[A-z]+(?:\\s[A-z]+)*,\\s[A-z]+\\s[A-z]+,\\s[A-Z]{2}\\s\\d{5}(?:-\\d{4})?$', title='Please enter a valid U.S. mailing address.') }}

      {{ radio_group('Can you currently legally be employed in the U.S.?', 'US-employment-status', [('Yes', 'Yes'), ('No', 'No')]) }}
      {{ radio_group('Have you graduated from high school/received your GED?', 'high-school-graduate-ged', [('Yes', 'Yes'), ('No', 'No')]) }}

      <button type="button" class="orange-button" onclick="validateForm()">
        Continue
      </button>
    {% endcall %}
  </form>
</section>

<script>
// Enhanced form validation
function validateForm() {
  let isValid = true;
  const form = document.getElementById('app-form-1');
  
  // Clear previous validation styling
  form.querySelectorAll('.invalid').forEach(el => el.classList.remove('invalid'));
  form.querySelectorAll('.validation-message').forEach(el => el.style.display = 'none');
  
  // Validate required fields
  const requiredFields = form.querySelectorAll('input[required], select[required], textarea[required]');
  requiredFields.forEach(field => {
    if (!field.value.trim()) {
      field.classList.add('invalid');
      isValid = false;
    }
  });
  
  // Validate pronouns group (at least one checkbox must be selected)
  const pronounsGroup = form.querySelector('.pronouns-group');
  const pronounsCheckboxes = pronounsGroup.querySelectorAll('input[type="checkbox"]');
  const pronounsChecked = Array.from(pronounsCheckboxes).some(cb => cb.checked);
  
  if (!pronounsChecked) {
    pronounsGroup.classList.add('invalid');
    pronounsGroup.querySelector('.validation-message').style.display = 'block';
    isValid = false;
  }
  
  // Validate radio groups (each group must have one selected)
  const radioGroups = form.querySelectorAll('.radio-wrapper');
  radioGroups.forEach(group => {
    const radios = group.querySelectorAll('input[type="radio"]');
    const hasSelection = Array.from(radios).some(radio => radio.checked);
    if (!hasSelection) {
      group.classList.add('invalid');
      isValid = false;
    }
  });
  
  if (isValid) {
    // Form is valid, proceed to next page
    console.log('Form is valid, proceeding...');
    // Add your navigation logic here
  } else {
    // Scroll to first invalid field
    const firstInvalid = form.querySelector('.invalid');
    if (firstInvalid) {
      firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }
}

// Add real-time validation
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('app-form-1');
  
  // Remove invalid styling when user starts fixing the field
  form.addEventListener('input', function(e) {
    if (e.target.classList.contains('invalid')) {
      e.target.classList.remove('invalid');
    }
  });
  
  // Handle pronouns validation
  const pronounsCheckboxes = form.querySelectorAll('.pronouns-group input[type="checkbox"]');
  pronounsCheckboxes.forEach(checkbox => {
    checkbox.addEventListener('change', function() {
      const pronounsGroup = this.closest('.pronouns-group');
      const anyChecked = Array.from(pronounsCheckboxes).some(cb => cb.checked);
      
      if (anyChecked) {
        pronounsGroup.classList.remove('invalid');
        pronounsGroup.querySelector('.validation-message').style.display = 'none';
      }
    });
  });
  
  // Handle radio group validation
  const radioInputs = form.querySelectorAll('input[type="radio"]');
  radioInputs.forEach(radio => {
    radio.addEventListener('change', function() {
      const radioWrapper = this.closest('.radio-wrapper');
      if (radioWrapper) {
        radioWrapper.classList.remove('invalid');
      }
    });
  });
});
</script>

<script src="{{ url_for('static', filename='js/form.js') }}"></script>
{% endblock content %}
